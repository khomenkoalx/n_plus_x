Merge Left Join  (cost=1425.37..8869157286.61 rows=46359 width=990) (actual time=23303.823..2588865.781 rows=2456 loops=1)
  Merge Cond: (promotion.id_client = fct_client.id_client)
  ->  Merge Left Join  (cost=808.51..849.47 rows=1667 width=614) (actual time=18734.269..18756.951 rows=2456 loops=1)
        Merge Cond: ((promotion.id_client = plus_x.id_client) AND (promo_sku.id_common_sku = dim_sku.id_common_sku) AND (promotion.start_date = plus_x.sale_date))
        ->  Sort  (cost=267.06..271.23 rows=1667 width=608) (actual time=18727.008..18729.322 rows=2456 loops=1)
              Sort Key: promotion.id_client, promo_sku.id_common_sku, promotion.start_date
              Sort Method: quicksort  Memory: 509kB
              ->  Hash Left Join  (cost=71.30..177.86 rows=1667 width=608) (actual time=18722.880..18725.394 rows=2456 loops=1)
                    Hash Cond: (promo_sku.id_common_sku = common_sku.id_common_sku)
                    ->  Hash Left Join  (cost=30.12..132.27 rows=1667 width=536) (actual time=18722.578..18724.543 rows=2456 loops=1)
                          Hash Cond: (promotion.id_promotion_type = promotion_type.id_promotion_type)
                          ->  Hash Join  (cost=16.98..114.61 rows=1667 width=20) (actual time=18722.513..18723.994 rows=2456 loops=1)
                                Hash Cond: (promo_sku.id_promotion = promotion.id_promotion)
                                ->  Seq Scan on lnk_promo_common_sku promo_sku  (cost=0.00..90.91 rows=2538 width=8) (actual time=18721.892..18722.846 rows=2456 loops=1)
                                      Filter: (delete_date IS NULL)
                                      Rows Removed by Filter: 1454
                                ->  Hash  (cost=13.60..13.60 rows=270 width=20) (actual time=0.398..0.400 rows=305 loops=1)
                                      Buckets: 1024  Batches: 1  Memory Usage: 24kB
                                      ->  Seq Scan on fct_promotion promotion  (cost=0.00..13.60 rows=270 width=20) (actual time=0.195..0.316 rows=305 loops=1)
                                            Filter: ((delete_date IS NULL) AND (start_date >= '2023-11-01'::date))
                                            Rows Removed by Filter: 109
                          ->  Hash  (cost=11.40..11.40 rows=140 width=520) (actual time=0.039..0.040 rows=5 loops=1)
                                Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                ->  Seq Scan on dict_promotion_type promotion_type  (cost=0.00..11.40 rows=140 width=520) (actual time=0.028..0.029 rows=5 loops=1)
                    ->  Hash  (cost=34.41..34.41 rows=541 width=76) (actual time=0.273..0.273 rows=549 loops=1)
                          Buckets: 1024  Batches: 1  Memory Usage: 68kB
                          ->  Seq Scan on dim_common_sku common_sku  (cost=0.00..34.41 rows=541 width=76) (actual time=0.017..0.150 rows=549 loops=1)
        ->  Sort  (cost=541.45..547.47 rows=2407 width=18) (actual time=7.192..10.244 rows=2539 loops=1)
              Sort Key: plus_x.id_client, dim_sku.id_common_sku, plus_x.sale_date
              Sort Method: quicksort  Memory: 295kB
              ->  Hash Join  (cost=97.33..406.26 rows=2407 width=18) (actual time=0.665..3.946 rows=2539 loops=1)
                    Hash Cond: (plus_x.id_sku = dim_sku.id_sku)
                    ->  Seq Scan on fct_promo_n_plus_x plus_x  (cost=0.00..302.59 rows=2407 width=18) (actual time=0.057..2.795 rows=2539 loops=1)
                          Filter: (delete_date IS NULL)
                          Rows Removed by Filter: 4740
                    ->  Hash  (cost=81.59..81.59 rows=1259 width=8) (actual time=0.576..0.576 rows=1272 loops=1)
                          Buckets: 2048  Batches: 1  Memory Usage: 66kB
                          ->  Seq Scan on dim_sku  (cost=0.00..81.59 rows=1259 width=8) (actual time=0.017..0.373 rows=1272 loops=1)
  ->  Materialize  (cost=616.85..728.12 rows=5562 width=44) (actual time=2.876..6.542 rows=2609 loops=1)
        ->  Unique  (cost=616.85..658.59 rows=5562 width=44) (actual time=2.872..2.976 rows=159 loops=1)
              ->  Sort  (cost=616.85..630.77 rows=5565 width=44) (actual time=2.871..2.899 rows=170 loops=1)
                    Sort Key: fct_client.id_client, fct_client.client_name
                    Sort Method: quicksort  Memory: 757kB
                    ->  Seq Scan on fct_client  (cost=0.00..270.65 rows=5565 width=44) (actual time=0.030..1.145 rows=5618 loops=1)
                          Filter: (delete_date IS NULL)
                          Rows Removed by Filter: 10
  SubPlan 2
    ->  Aggregate  (cost=18249.39..18249.40 rows=1 width=32) (actual time=84.796..84.796 rows=1 loops=2456)
          ->  Nested Loop  (cost=1280.57..18249.38 rows=1 width=5) (actual time=28.436..84.772 rows=34 loops=2456)
                Join Filter: (fss.id_sku = sku_1.id_sku)
                Rows Removed by Join Filter: 9929
                ->  Append  (cost=1280.57..18153.87 rows=359 width=9) (actual time=14.345..82.349 rows=2603 loops=2456)
                      ->  Index Scan using fct_sale_second_y2020_pkey on fct_sale_second_y2020 fss_1  (cost=1280.57..1288.64 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 1)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            SubPlan 1
                              ->  Nested Loop  (cost=0.43..1280.04 rows=152 width=8) (actual time=1.386..10.567 rows=2108 loops=2543)
                                    ->  Seq Scan on dim_sku sku  (cost=0.00..84.74 rows=2 width=4) (actual time=0.085..0.195 rows=4 loops=2543)
                                          Filter: (id_common_sku = promo_sku.id_common_sku)
                                          Rows Removed by Filter: 1268
                                    ->  Index Only Scan using idx_promo_n_plus_x_exception_composite on promo_n_plus_x_exception exc  (cost=0.43..593.79 rows=386 width=12) (actual time=0.332..2.381 rows=495 loops=10819)
                                          Index Cond: ((id_client = promotion.id_client) AND (id_sku = sku.id_sku) AND (start_date <= promotion.start_date) AND (end_date >= promotion.start_date))
                                          Heap Fetches: 978177
                      ->  Index Scan using fct_sale_second_y2021_pkey on fct_sale_second_y2021 fss_2  (cost=1280.57..1288.64 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 1)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                      ->  Bitmap Heap Scan on fct_sale_second_y2022 fss_3  (cost=1715.32..3629.77 rows=130 width=8) (never executed)
                            Recheck Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 1)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            ->  Bitmap Index Scan on fct_sale_second_y2022_pkey  (cost=0.00..434.86 rows=521 width=0) (never executed)
                                  Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Bitmap Heap Scan on fct_sale_second_y2023 fss_4  (cost=2193.11..3656.67 rows=95 width=8) (actual time=56.608..66.189 rows=2028 loops=162)
                            Recheck Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 1)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            Rows Removed by Filter: 8764
                            Heap Blocks: exact=73208
                            ->  Bitmap Index Scan on fct_sale_second_y2023_pkey  (cost=0.00..912.66 rows=379 width=0) (actual time=33.179..33.179 rows=10792 loops=162)
                                  Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2024_pkey on fct_sale_second_y2024 fss_5  (cost=1280.85..3407.30 rows=82 width=9) (actual time=11.626..84.734 rows=2513 loops=1397)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 1)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            Rows Removed by Filter: 16089
                      ->  Index Scan using fct_sale_second_y2025_pkey on fct_sale_second_y2025 fss_6  (cost=1280.85..2303.79 rows=48 width=9) (actual time=10.436..67.449 rows=2395 loops=1067)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 1)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            Rows Removed by Filter: 19339
                      ->  Index Scan using fct_sale_second_y2026_pkey on fct_sale_second_y2026 fss_7  (cost=1280.57..1288.64 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 1)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                      ->  Index Scan using fct_sale_second_y2027_pkey on fct_sale_second_y2027 fss_8  (cost=1280.57..1288.64 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 1)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                ->  Materialize  (cost=0.00..84.75 rows=2 width=4) (actual time=0.000..0.000 rows=4 loops=6393774)
                      ->  Seq Scan on dim_sku sku_1  (cost=0.00..84.74 rows=2 width=4) (actual time=0.046..0.123 rows=4 loops=2372)
                            Filter: (id_common_sku = promo_sku.id_common_sku)
                            Rows Removed by Filter: 1268
  SubPlan 4
    ->  Aggregate  (cost=18249.41..18249.42 rows=1 width=32) (actual time=55.665..55.665 rows=1 loops=2456)
          ->  Nested Loop  (cost=1280.57..18249.38 rows=1 width=5) (actual time=14.598..55.624 rows=34 loops=2456)
                Join Filter: (fss_9.id_sku = sku_3.id_sku)
                Rows Removed by Join Filter: 9929
                ->  Append  (cost=1280.57..18153.87 rows=359 width=9) (actual time=5.183..53.547 rows=2603 loops=2456)
                      ->  Index Scan using fct_sale_second_y2020_pkey on fct_sale_second_y2020 fss_10  (cost=1280.57..1288.64 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 3)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            SubPlan 3
                              ->  Nested Loop  (cost=0.43..1280.04 rows=152 width=8) (actual time=0.288..1.955 rows=2108 loops=2543)
                                    ->  Seq Scan on dim_sku sku_2  (cost=0.00..84.74 rows=2 width=4) (actual time=0.111..0.253 rows=4 loops=2543)
                                          Filter: (id_common_sku = promo_sku.id_common_sku)
                                          Rows Removed by Filter: 1268
                                    ->  Index Only Scan using idx_promo_n_plus_x_exception_composite on promo_n_plus_x_exception exc_1  (cost=0.43..593.79 rows=386 width=12) (actual time=0.025..0.342 rows=495 loops=10819)
                                          Index Cond: ((id_client = promotion.id_client) AND (id_sku = sku_2.id_sku) AND (start_date <= promotion.start_date) AND (end_date >= promotion.start_date))
                                          Heap Fetches: 978177
                      ->  Index Scan using fct_sale_second_y2021_pkey on fct_sale_second_y2021 fss_11  (cost=1280.57..1288.64 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 3)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                      ->  Bitmap Heap Scan on fct_sale_second_y2022 fss_12  (cost=1715.32..3629.77 rows=130 width=8) (never executed)
                            Recheck Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 3)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            ->  Bitmap Index Scan on fct_sale_second_y2022_pkey  (cost=0.00..434.86 rows=521 width=0) (never executed)
                                  Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Bitmap Heap Scan on fct_sale_second_y2023 fss_13  (cost=2193.11..3656.67 rows=95 width=8) (actual time=37.127..46.094 rows=2028 loops=162)
                            Recheck Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 3)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            Rows Removed by Filter: 8764
                            Heap Blocks: exact=73208
                            ->  Bitmap Index Scan on fct_sale_second_y2023_pkey  (cost=0.00..912.66 rows=379 width=0) (actual time=34.069..34.069 rows=10792 loops=162)
                                  Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2024_pkey on fct_sale_second_y2024 fss_14  (cost=1280.85..3407.30 rows=82 width=9) (actual time=3.466..52.258 rows=2513 loops=1397)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 3)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            Rows Removed by Filter: 16089
                      ->  Index Scan using fct_sale_second_y2025_pkey on fct_sale_second_y2025 fss_15  (cost=1280.85..2303.79 rows=48 width=9) (actual time=2.858..46.933 rows=2395 loops=1067)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 3)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            Rows Removed by Filter: 19339
                      ->  Index Scan using fct_sale_second_y2026_pkey on fct_sale_second_y2026 fss_16  (cost=1280.57..1288.64 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 3)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                      ->  Index Scan using fct_sale_second_y2027_pkey on fct_sale_second_y2027 fss_17  (cost=1280.57..1288.64 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 3)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                ->  Materialize  (cost=0.00..84.75 rows=2 width=4) (actual time=0.000..0.000 rows=4 loops=6393774)
                      ->  Seq Scan on dim_sku sku_3  (cost=0.00..84.74 rows=2 width=4) (actual time=0.046..0.123 rows=4 loops=2372)
                            Filter: (id_common_sku = promo_sku.id_common_sku)
                            Rows Removed by Filter: 1268
  SubPlan 6
    ->  Aggregate  (cost=18249.39..18249.40 rows=1 width=32) (actual time=47.834..47.834 rows=1 loops=2456)
          ->  Nested Loop  (cost=1280.57..18249.38 rows=1 width=5) (actual time=12.623..47.814 rows=34 loops=2456)
                Join Filter: (fss_18.id_sku = sku_5.id_sku)
                Rows Removed by Join Filter: 9929
                ->  Append  (cost=1280.57..18153.87 rows=359 width=9) (actual time=4.362..45.827 rows=2603 loops=2456)
                      ->  Index Scan using fct_sale_second_y2020_pkey on fct_sale_second_y2020 fss_19  (cost=1280.57..1288.64 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 5)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            SubPlan 5
                              ->  Nested Loop  (cost=0.43..1280.04 rows=152 width=8) (actual time=0.255..1.820 rows=2108 loops=2543)
                                    ->  Seq Scan on dim_sku sku_4  (cost=0.00..84.74 rows=2 width=4) (actual time=0.099..0.218 rows=4 loops=2543)
                                          Filter: (id_common_sku = promo_sku.id_common_sku)
                                          Rows Removed by Filter: 1268
                                    ->  Index Only Scan using idx_promo_n_plus_x_exception_composite on promo_n_plus_x_exception exc_2  (cost=0.43..593.79 rows=386 width=12) (actual time=0.022..0.321 rows=495 loops=10819)
                                          Index Cond: ((id_client = promotion.id_client) AND (id_sku = sku_4.id_sku) AND (start_date <= promotion.start_date) AND (end_date >= promotion.start_date))
                                          Heap Fetches: 978177
                      ->  Index Scan using fct_sale_second_y2021_pkey on fct_sale_second_y2021 fss_20  (cost=1280.57..1288.64 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 5)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                      ->  Bitmap Heap Scan on fct_sale_second_y2022 fss_21  (cost=1715.32..3629.77 rows=130 width=8) (never executed)
                            Recheck Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 5)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            ->  Bitmap Index Scan on fct_sale_second_y2022_pkey  (cost=0.00..434.86 rows=521 width=0) (never executed)
                                  Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Bitmap Heap Scan on fct_sale_second_y2023 fss_22  (cost=2193.11..3656.67 rows=95 width=8) (actual time=27.292..32.964 rows=2028 loops=162)
                            Recheck Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 5)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            Rows Removed by Filter: 8764
                            Heap Blocks: exact=73208
                            ->  Bitmap Index Scan on fct_sale_second_y2023_pkey  (cost=0.00..912.66 rows=379 width=0) (actual time=24.600..24.600 rows=10792 loops=162)
                                  Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2024_pkey on fct_sale_second_y2024 fss_23  (cost=1280.85..3407.30 rows=82 width=9) (actual time=3.005..44.416 rows=2513 loops=1397)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 5)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            Rows Removed by Filter: 16089
                      ->  Index Scan using fct_sale_second_y2025_pkey on fct_sale_second_y2025 fss_24  (cost=1280.85..2303.79 rows=48 width=9) (actual time=2.732..41.537 rows=2395 loops=1067)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 5)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            Rows Removed by Filter: 19339
                      ->  Index Scan using fct_sale_second_y2026_pkey on fct_sale_second_y2026 fss_25  (cost=1280.57..1288.64 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 5)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                      ->  Index Scan using fct_sale_second_y2027_pkey on fct_sale_second_y2027 fss_26  (cost=1280.57..1288.64 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 5)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                ->  Materialize  (cost=0.00..84.75 rows=2 width=4) (actual time=0.000..0.000 rows=4 loops=6393774)
                      ->  Seq Scan on dim_sku sku_5  (cost=0.00..84.74 rows=2 width=4) (actual time=0.046..0.126 rows=4 loops=2372)
                            Filter: (id_common_sku = promo_sku.id_common_sku)
                            Rows Removed by Filter: 1268
  SubPlan 8
    ->  Aggregate  (cost=18249.41..18249.42 rows=1 width=32) (actual time=45.584..45.584 rows=1 loops=2456)
          ->  Nested Loop  (cost=1280.57..18249.38 rows=1 width=5) (actual time=11.724..45.548 rows=34 loops=2456)
                Join Filter: (fss_27.id_sku = sku_7.id_sku)
                Rows Removed by Join Filter: 9929
                ->  Append  (cost=1280.57..18153.87 rows=359 width=9) (actual time=4.016..43.570 rows=2603 loops=2456)
                      ->  Index Scan using fct_sale_second_y2020_pkey on fct_sale_second_y2020 fss_28  (cost=1280.57..1288.64 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 7)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            SubPlan 7
                              ->  Nested Loop  (cost=0.43..1280.04 rows=152 width=8) (actual time=0.247..1.785 rows=2108 loops=2543)
                                    ->  Seq Scan on dim_sku sku_6  (cost=0.00..84.74 rows=2 width=4) (actual time=0.094..0.211 rows=4 loops=2543)
                                          Filter: (id_common_sku = promo_sku.id_common_sku)
                                          Rows Removed by Filter: 1268
                                    ->  Index Only Scan using idx_promo_n_plus_x_exception_composite on promo_n_plus_x_exception exc_3  (cost=0.43..593.79 rows=386 width=12) (actual time=0.022..0.314 rows=495 loops=10819)
                                          Index Cond: ((id_client = promotion.id_client) AND (id_sku = sku_6.id_sku) AND (start_date <= promotion.start_date) AND (end_date >= promotion.start_date))
                                          Heap Fetches: 978177
                      ->  Index Scan using fct_sale_second_y2021_pkey on fct_sale_second_y2021 fss_29  (cost=1280.57..1288.64 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 7)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                      ->  Bitmap Heap Scan on fct_sale_second_y2022 fss_30  (cost=1715.32..3629.77 rows=130 width=8) (never executed)
                            Recheck Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 7)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            ->  Bitmap Index Scan on fct_sale_second_y2022_pkey  (cost=0.00..434.86 rows=521 width=0) (never executed)
                                  Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Bitmap Heap Scan on fct_sale_second_y2023 fss_31  (cost=2193.11..3656.67 rows=95 width=8) (actual time=22.792..27.859 rows=2028 loops=162)
                            Recheck Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 7)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            Rows Removed by Filter: 8764
                            Heap Blocks: exact=73208
                            ->  Bitmap Index Scan on fct_sale_second_y2023_pkey  (cost=0.00..912.66 rows=379 width=0) (actual time=20.198..20.198 rows=10792 loops=162)
                                  Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2024_pkey on fct_sale_second_y2024 fss_32  (cost=1280.85..3407.30 rows=82 width=9) (actual time=2.925..42.601 rows=2513 loops=1397)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 7)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            Rows Removed by Filter: 16089
                      ->  Index Scan using fct_sale_second_y2025_pkey on fct_sale_second_y2025 fss_33  (cost=1280.85..2303.79 rows=48 width=9) (actual time=2.685..39.478 rows=2395 loops=1067)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 7)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            Rows Removed by Filter: 19339
                      ->  Index Scan using fct_sale_second_y2026_pkey on fct_sale_second_y2026 fss_34  (cost=1280.57..1288.64 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 7)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                      ->  Index Scan using fct_sale_second_y2027_pkey on fct_sale_second_y2027 fss_35  (cost=1280.57..1288.64 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 7)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                ->  Materialize  (cost=0.00..84.75 rows=2 width=4) (actual time=0.000..0.000 rows=4 loops=6393774)
                      ->  Seq Scan on dim_sku sku_7  (cost=0.00..84.74 rows=2 width=4) (actual time=0.045..0.121 rows=4 loops=2372)
                            Filter: (id_common_sku = promo_sku.id_common_sku)
                            Rows Removed by Filter: 1268
  SubPlan 9
    ->  Aggregate  (cost=6474.09..6474.10 rows=1 width=32) (actual time=86.139..86.139 rows=1 loops=2456)
          ->  Nested Loop  (cost=0.14..6474.08 rows=2 width=4) (actual time=42.321..86.098 rows=138 loops=2456)
                ->  Seq Scan on dim_sku sku_8  (cost=0.00..84.74 rows=2 width=4) (actual time=0.063..0.205 rows=4 loops=2456)
                      Filter: (id_common_sku = promo_sku.id_common_sku)
                      Rows Removed by Filter: 1268
                ->  Append  (cost=0.14..3194.58 rows=9 width=8) (actual time=15.528..19.798 rows=32 loops=10648)
                      ->  Index Scan using fct_sale_second_y2020_pkey on fct_sale_second_y2020 fss_37  (cost=0.14..6.17 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_sku = sku_8.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2021_pkey on fct_sale_second_y2021 fss_38  (cost=0.14..6.17 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_sku = sku_8.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2022_pkey on fct_sale_second_y2022 fss_39  (cost=0.43..462.07 rows=2 width=8) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_sku = sku_8.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2023_pkey on fct_sale_second_y2023 fss_40  (cost=0.43..954.70 rows=1 width=8) (actual time=14.131..18.302 rows=15 loops=588)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_sku = sku_8.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2024_pkey on fct_sale_second_y2024 fss_41  (cost=0.43..1231.86 rows=1 width=9) (actual time=16.180..20.351 rows=32 loops=6161)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_sku = sku_8.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2025_pkey on fct_sale_second_y2025 fss_42  (cost=0.43..521.22 rows=1 width=9) (actual time=12.887..16.516 rows=30 loops=4515)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_sku = sku_8.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2026_pkey on fct_sale_second_y2026 fss_43  (cost=0.14..6.17 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_sku = sku_8.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2027_pkey on fct_sale_second_y2027 fss_44  (cost=0.14..6.17 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_sku = sku_8.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
  SubPlan 10
    ->  Aggregate  (cost=6474.09..6474.10 rows=1 width=32) (actual time=84.564..84.564 rows=1 loops=2456)
          ->  Nested Loop  (cost=0.14..6474.08 rows=2 width=4) (actual time=41.348..84.524 rows=138 loops=2456)
                ->  Seq Scan on dim_sku sku_9  (cost=0.00..84.74 rows=2 width=4) (actual time=0.066..0.205 rows=4 loops=2456)
                      Filter: (id_common_sku = promo_sku.id_common_sku)
                      Rows Removed by Filter: 1268
                ->  Append  (cost=0.14..3194.58 rows=9 width=8) (actual time=15.238..19.436 rows=32 loops=10648)
                      ->  Index Scan using fct_sale_second_y2020_pkey on fct_sale_second_y2020 fss_46  (cost=0.14..6.17 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_sku = sku_9.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2021_pkey on fct_sale_second_y2021 fss_47  (cost=0.14..6.17 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_sku = sku_9.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2022_pkey on fct_sale_second_y2022 fss_48  (cost=0.43..462.07 rows=2 width=8) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_sku = sku_9.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2023_pkey on fct_sale_second_y2023 fss_49  (cost=0.43..954.70 rows=1 width=8) (actual time=13.116..17.032 rows=15 loops=588)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_sku = sku_9.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2024_pkey on fct_sale_second_y2024 fss_50  (cost=0.43..1231.86 rows=1 width=9) (actual time=15.844..19.951 rows=32 loops=6161)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_sku = sku_9.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2025_pkey on fct_sale_second_y2025 fss_51  (cost=0.43..521.22 rows=1 width=9) (actual time=12.789..16.371 rows=30 loops=4515)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_sku = sku_9.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2026_pkey on fct_sale_second_y2026 fss_52  (cost=0.14..6.17 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_sku = sku_9.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2027_pkey on fct_sale_second_y2027 fss_53  (cost=0.14..6.17 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_sku = sku_9.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
  SubPlan 11
    ->  Aggregate  (cost=6474.21..6474.22 rows=1 width=32) (actual time=117.546..117.546 rows=1 loops=2456)
          ->  Nested Loop  (cost=0.15..6474.20 rows=2 width=4) (actual time=65.475..117.494 rows=132 loops=2456)
                ->  Seq Scan on dim_sku sku_10  (cost=0.00..84.74 rows=2 width=4) (actual time=0.063..0.224 rows=4 loops=2456)
                      Filter: (id_common_sku = promo_sku.id_common_sku)
                      Rows Removed by Filter: 1268
                ->  Append  (cost=0.15..3194.64 rows=9 width=8) (actual time=21.558..27.034 rows=30 loops=10648)
                      ->  Index Scan using fct_sale_second_y2020_pkey on fct_sale_second_y2020 fss_55  (cost=0.15..6.18 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_10.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2021_pkey on fct_sale_second_y2021 fss_56  (cost=0.15..6.18 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_10.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2022_pkey on fct_sale_second_y2022 fss_57  (cost=0.43..462.08 rows=2 width=8) (never executed)
                            Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_10.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2023_pkey on fct_sale_second_y2023 fss_58  (cost=0.44..954.71 rows=1 width=8) (actual time=30.829..37.253 rows=16 loops=1074)
                            Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_10.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2024_pkey on fct_sale_second_y2024 fss_59  (cost=0.44..1231.87 rows=1 width=9) (actual time=18.761..23.190 rows=28 loops=6505)
                            Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_10.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2025_pkey on fct_sale_second_y2025 fss_60  (cost=0.43..521.23 rows=1 width=9) (actual time=17.275..21.958 rows=28 loops=4412)
                            Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_10.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2026_pkey on fct_sale_second_y2026 fss_61  (cost=0.15..6.18 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_10.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2027_pkey on fct_sale_second_y2027 fss_62  (cost=0.15..6.18 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_10.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
  SubPlan 12
    ->  Aggregate  (cost=6474.21..6474.22 rows=1 width=32) (actual time=90.276..90.277 rows=1 loops=2456)
          ->  Nested Loop  (cost=0.15..6474.20 rows=2 width=4) (actual time=44.909..90.237 rows=132 loops=2456)
                ->  Seq Scan on dim_sku sku_11  (cost=0.00..84.74 rows=2 width=4) (actual time=0.073..0.217 rows=4 loops=2456)
                      Filter: (id_common_sku = promo_sku.id_common_sku)
                      Rows Removed by Filter: 1268
                ->  Append  (cost=0.15..3194.64 rows=9 width=8) (actual time=16.468..20.750 rows=30 loops=10648)
                      ->  Index Scan using fct_sale_second_y2020_pkey on fct_sale_second_y2020 fss_64  (cost=0.15..6.18 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_11.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2021_pkey on fct_sale_second_y2021 fss_65  (cost=0.15..6.18 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_11.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2022_pkey on fct_sale_second_y2022 fss_66  (cost=0.43..462.08 rows=2 width=8) (never executed)
                            Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_11.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2023_pkey on fct_sale_second_y2023 fss_67  (cost=0.44..954.71 rows=1 width=8) (actual time=17.091..21.609 rows=16 loops=1074)
                            Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_11.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2024_pkey on fct_sale_second_y2024 fss_68  (cost=0.44..1231.87 rows=1 width=9) (actual time=14.568..18.110 rows=28 loops=6505)
                            Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_11.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2025_pkey on fct_sale_second_y2025 fss_69  (cost=0.43..521.23 rows=1 width=9) (actual time=14.400..18.091 rows=28 loops=4412)
                            Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_11.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2026_pkey on fct_sale_second_y2026 fss_70  (cost=0.15..6.18 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_11.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2027_pkey on fct_sale_second_y2027 fss_71  (cost=0.15..6.18 rows=1 width=24) (never executed)
                            Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_11.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
  SubPlan 14
    ->  Aggregate  (cost=18249.39..18249.40 rows=1 width=8) (actual time=48.031..48.031 rows=1 loops=2456)
          ->  Nested Loop  (cost=1280.57..18249.38 rows=1 width=8) (actual time=12.102..47.996 rows=34 loops=2456)
                Join Filter: (fss_72.id_sku = sku_13.id_sku)
                Rows Removed by Join Filter: 9929
                ->  Append  (cost=1280.57..18153.87 rows=359 width=12) (actual time=4.072..46.100 rows=2603 loops=2456)
                      ->  Index Scan using fct_sale_second_y2020_pkey on fct_sale_second_y2020 fss_73  (cost=1280.57..1288.64 rows=1 width=12) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 13)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            SubPlan 13
                              ->  Nested Loop  (cost=0.43..1280.04 rows=152 width=8) (actual time=0.250..1.784 rows=2108 loops=2543)
                                    ->  Seq Scan on dim_sku sku_12  (cost=0.00..84.74 rows=2 width=4) (actual time=0.092..0.197 rows=4 loops=2543)
                                          Filter: (id_common_sku = promo_sku.id_common_sku)
                                          Rows Removed by Filter: 1268
                                    ->  Index Only Scan using idx_promo_n_plus_x_exception_composite on promo_n_plus_x_exception exc_4  (cost=0.43..593.79 rows=386 width=12) (actual time=0.023..0.319 rows=495 loops=10819)
                                          Index Cond: ((id_client = promotion.id_client) AND (id_sku = sku_12.id_sku) AND (start_date <= promotion.start_date) AND (end_date >= promotion.start_date))
                                          Heap Fetches: 978177
                      ->  Index Scan using fct_sale_second_y2021_pkey on fct_sale_second_y2021 fss_74  (cost=1280.57..1288.64 rows=1 width=12) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 13)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                      ->  Bitmap Heap Scan on fct_sale_second_y2022 fss_75  (cost=1715.32..3629.77 rows=130 width=12) (never executed)
                            Recheck Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 13)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            ->  Bitmap Index Scan on fct_sale_second_y2022_pkey  (cost=0.00..434.86 rows=521 width=0) (never executed)
                                  Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Bitmap Heap Scan on fct_sale_second_y2023 fss_76  (cost=2193.11..3656.67 rows=95 width=12) (actual time=22.986..30.572 rows=2028 loops=162)
                            Recheck Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 13)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            Rows Removed by Filter: 8764
                            Heap Blocks: exact=73208
                            ->  Bitmap Index Scan on fct_sale_second_y2023_pkey  (cost=0.00..912.66 rows=379 width=0) (actual time=20.292..20.292 rows=10792 loops=162)
                                  Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                      ->  Index Scan using fct_sale_second_y2024_pkey on fct_sale_second_y2024 fss_77  (cost=1280.85..3407.30 rows=82 width=12) (actual time=2.996..45.997 rows=2513 loops=1397)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 13)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            Rows Removed by Filter: 16089
                      ->  Index Scan using fct_sale_second_y2025_pkey on fct_sale_second_y2025 fss_78  (cost=1280.85..2303.79 rows=48 width=12) (actual time=2.738..40.391 rows=2395 loops=1067)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 13)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                            Rows Removed by Filter: 19339
                      ->  Index Scan using fct_sale_second_y2026_pkey on fct_sale_second_y2026 fss_79  (cost=1280.57..1288.64 rows=1 width=12) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 13)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                      ->  Index Scan using fct_sale_second_y2027_pkey on fct_sale_second_y2027 fss_80  (cost=1280.57..1288.64 rows=1 width=12) (never executed)
                            Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            Filter: ((NOT (hashed SubPlan 13)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                ->  Materialize  (cost=0.00..84.75 rows=2 width=4) (actual time=0.000..0.000 rows=4 loops=6393774)
                      ->  Seq Scan on dim_sku sku_13  (cost=0.00..84.74 rows=2 width=4) (actual time=0.045..0.121 rows=4 loops=2372)
                            Filter: (id_common_sku = promo_sku.id_common_sku)
                            Rows Removed by Filter: 1268
  SubPlan 16
    ->  Aggregate  (cost=24723.63..24723.64 rows=1 width=8) (actual time=129.386..129.386 rows=1 loops=2456)
          ->  Hash Join  (cost=18249.57..24723.63 rows=1 width=8) (actual time=102.055..129.354 rows=11 loops=2456)
                Hash Cond: (fss_81.tin_buyer = fss_90.tin_buyer)
                ->  Nested Loop  (cost=0.15..6474.20 rows=2 width=8) (actual time=45.227..92.214 rows=138 loops=2225)
                      ->  Seq Scan on dim_sku sku_15  (cost=0.00..84.74 rows=2 width=4) (actual time=0.063..0.211 rows=4 loops=2225)
                            Filter: (promo_sku.id_common_sku = id_common_sku)
                            Rows Removed by Filter: 1265
                      ->  Append  (cost=0.15..3194.64 rows=9 width=12) (actual time=16.767..21.249 rows=32 loops=9628)
                            ->  Index Scan using fct_sale_second_y2020_pkey on fct_sale_second_y2020 fss_82  (cost=0.15..6.18 rows=1 width=12) (never executed)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_15.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2021_pkey on fct_sale_second_y2021 fss_83  (cost=0.15..6.18 rows=1 width=12) (never executed)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_15.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2022_pkey on fct_sale_second_y2022 fss_84  (cost=0.43..462.08 rows=2 width=12) (never executed)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_15.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2023_pkey on fct_sale_second_y2023 fss_85  (cost=0.44..954.71 rows=1 width=12) (actual time=17.270..21.951 rows=16 loops=1068)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_15.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2024_pkey on fct_sale_second_y2024 fss_86  (cost=0.44..1231.87 rows=1 width=12) (actual time=14.914..18.537 rows=30 loops=6130)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_15.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2025_pkey on fct_sale_second_y2025 fss_87  (cost=0.43..521.23 rows=1 width=12) (actual time=14.067..17.970 rows=29 loops=3751)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_15.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2026_pkey on fct_sale_second_y2026 fss_88  (cost=0.15..6.18 rows=1 width=12) (never executed)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_15.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2027_pkey on fct_sale_second_y2027 fss_89  (cost=0.15..6.18 rows=1 width=12) (never executed)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_15.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                ->  Hash  (cost=18249.41..18249.41 rows=1 width=8) (actual time=45.920..45.920 rows=27 loops=2448)
                      Buckets: 1024  Batches: 1  Memory Usage: 43kB
                      ->  Unique  (cost=18249.39..18249.40 rows=1 width=8) (actual time=45.901..45.910 rows=27 loops=2448)
                            ->  Sort  (cost=18249.39..18249.40 rows=1 width=8) (actual time=45.898..45.900 rows=34 loops=2448)
                                  Sort Key: fss_90.tin_buyer
                                  Sort Method: quicksort  Memory: 25kB
                                  ->  Nested Loop  (cost=1280.57..18249.38 rows=1 width=8) (actual time=11.731..45.872 rows=34 loops=2448)
                                        Join Filter: (fss_90.id_sku = sku_16.id_sku)
                                        Rows Removed by Join Filter: 9936
                                        ->  Append  (cost=1280.57..18153.87 rows=359 width=12) (actual time=4.196..43.991 rows=2608 loops=2448)
                                              ->  Index Scan using fct_sale_second_y2020_pkey on fct_sale_second_y2020 fss_91  (cost=1280.57..1288.64 rows=1 width=12) (never executed)
                                                    Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 15)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                                    SubPlan 15
                                                      ->  Nested Loop  (cost=0.43..1280.04 rows=152 width=8) (actual time=0.236..1.756 rows=2108 loops=2537)
                                                            ->  Seq Scan on dim_sku sku_14  (cost=0.00..84.74 rows=2 width=4) (actual time=0.087..0.202 rows=4 loops=2537)
                                                                  Filter: (id_common_sku = promo_sku.id_common_sku)
                                                                  Rows Removed by Filter: 1268
                                                            ->  Index Only Scan using idx_promo_n_plus_x_exception_composite on promo_n_plus_x_exception exc_5  (cost=0.43..593.79 rows=386 width=12) (actual time=0.021..0.311 rows=496 loops=10783)
                                                                  Index Cond: ((id_client = promotion.id_client) AND (id_sku = sku_14.id_sku) AND (start_date <= promotion.start_date) AND (end_date >= promotion.start_date))
                                                                  Heap Fetches: 978052
                                              ->  Index Scan using fct_sale_second_y2021_pkey on fct_sale_second_y2021 fss_92  (cost=1280.57..1288.64 rows=1 width=12) (never executed)
                                                    Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 15)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                              ->  Bitmap Heap Scan on fct_sale_second_y2022 fss_93  (cost=1715.32..3629.77 rows=130 width=12) (never executed)
                                                    Recheck Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 15)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                                    ->  Bitmap Index Scan on fct_sale_second_y2022_pkey  (cost=0.00..434.86 rows=521 width=0) (never executed)
                                                          Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                              ->  Bitmap Heap Scan on fct_sale_second_y2023 fss_94  (cost=2193.11..3656.67 rows=95 width=12) (actual time=26.005..31.798 rows=2028 loops=162)
                                                    Recheck Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 15)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                                    Rows Removed by Filter: 8764
                                                    Heap Blocks: exact=73208
                                                    ->  Bitmap Index Scan on fct_sale_second_y2023_pkey  (cost=0.00..912.66 rows=379 width=0) (actual time=23.449..23.449 rows=10792 loops=162)
                                                          Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                              ->  Index Scan using fct_sale_second_y2024_pkey on fct_sale_second_y2024 fss_95  (cost=1280.85..3407.30 rows=82 width=12) (actual time=2.984..43.694 rows=2515 loops=1393)
                                                    Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 15)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                                    Rows Removed by Filter: 16125
                                              ->  Index Scan using fct_sale_second_y2025_pkey on fct_sale_second_y2025 fss_96  (cost=1280.85..2303.79 rows=48 width=12) (actual time=2.614..38.431 rows=2401 loops=1063)
                                                    Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 15)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                                    Rows Removed by Filter: 19390
                                              ->  Index Scan using fct_sale_second_y2026_pkey on fct_sale_second_y2026 fss_97  (cost=1280.57..1288.64 rows=1 width=12) (never executed)
                                                    Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 15)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                              ->  Index Scan using fct_sale_second_y2027_pkey on fct_sale_second_y2027 fss_98  (cost=1280.57..1288.64 rows=1 width=12) (never executed)
                                                    Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 15)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                        ->  Materialize  (cost=0.00..84.75 rows=2 width=4) (actual time=0.000..0.000 rows=4 loops=6384397)
                                              ->  Seq Scan on dim_sku sku_16  (cost=0.00..84.74 rows=2 width=4) (actual time=0.044..0.119 rows=4 loops=2366)
                                                    Filter: (id_common_sku = promo_sku.id_common_sku)
                                                    Rows Removed by Filter: 1268
  SubPlan 18
    ->  Aggregate  (cost=24723.64..24723.65 rows=1 width=32) (actual time=128.403..128.403 rows=1 loops=2456)
          ->  Hash Join  (cost=18249.57..24723.63 rows=1 width=4) (actual time=101.398..128.385 rows=11 loops=2456)
                Hash Cond: (fss_99.tin_buyer = fss_108.tin_buyer)
                ->  Nested Loop  (cost=0.15..6474.20 rows=2 width=12) (actual time=43.778..90.134 rows=138 loops=2225)
                      ->  Seq Scan on dim_sku sku_18  (cost=0.00..84.74 rows=2 width=4) (actual time=0.063..0.213 rows=4 loops=2225)
                            Filter: (promo_sku.id_common_sku = id_common_sku)
                            Rows Removed by Filter: 1265
                      ->  Append  (cost=0.15..3194.64 rows=9 width=16) (actual time=16.314..20.767 rows=32 loops=9628)
                            ->  Index Scan using fct_sale_second_y2020_pkey on fct_sale_second_y2020 fss_100  (cost=0.15..6.18 rows=1 width=32) (never executed)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_18.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2021_pkey on fct_sale_second_y2021 fss_101  (cost=0.15..6.18 rows=1 width=32) (never executed)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_18.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2022_pkey on fct_sale_second_y2022 fss_102  (cost=0.43..462.08 rows=2 width=16) (never executed)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_18.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2023_pkey on fct_sale_second_y2023 fss_103  (cost=0.44..954.71 rows=1 width=16) (actual time=16.622..21.111 rows=16 loops=1068)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_18.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2024_pkey on fct_sale_second_y2024 fss_104  (cost=0.44..1231.87 rows=1 width=17) (actual time=14.321..17.878 rows=30 loops=6130)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_18.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2025_pkey on fct_sale_second_y2025 fss_105  (cost=0.43..521.23 rows=1 width=17) (actual time=14.057..18.051 rows=29 loops=3751)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_18.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2026_pkey on fct_sale_second_y2026 fss_106  (cost=0.15..6.18 rows=1 width=32) (never executed)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_18.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2027_pkey on fct_sale_second_y2027 fss_107  (cost=0.15..6.18 rows=1 width=32) (never executed)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_18.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                ->  Hash  (cost=18249.41..18249.41 rows=1 width=8) (actual time=46.840..46.840 rows=27 loops=2448)
                      Buckets: 1024  Batches: 1  Memory Usage: 43kB
                      ->  Unique  (cost=18249.39..18249.40 rows=1 width=8) (actual time=46.821..46.829 rows=27 loops=2448)
                            ->  Sort  (cost=18249.39..18249.40 rows=1 width=8) (actual time=46.817..46.820 rows=34 loops=2448)
                                  Sort Key: fss_108.tin_buyer
                                  Sort Method: quicksort  Memory: 25kB
                                  ->  Nested Loop  (cost=1280.57..18249.38 rows=1 width=8) (actual time=11.862..46.792 rows=34 loops=2448)
                                        Join Filter: (fss_108.id_sku = sku_19.id_sku)
                                        Rows Removed by Join Filter: 9936
                                        ->  Append  (cost=1280.57..18153.87 rows=359 width=12) (actual time=4.218..44.901 rows=2608 loops=2448)
                                              ->  Index Scan using fct_sale_second_y2020_pkey on fct_sale_second_y2020 fss_109  (cost=1280.57..1288.64 rows=1 width=12) (never executed)
                                                    Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 17)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                                    SubPlan 17
                                                      ->  Nested Loop  (cost=0.43..1280.04 rows=152 width=8) (actual time=0.242..1.727 rows=2108 loops=2537)
                                                            ->  Seq Scan on dim_sku sku_17  (cost=0.00..84.74 rows=2 width=4) (actual time=0.088..0.195 rows=4 loops=2537)
                                                                  Filter: (id_common_sku = promo_sku.id_common_sku)
                                                                  Rows Removed by Filter: 1268
                                                            ->  Index Only Scan using idx_promo_n_plus_x_exception_composite on promo_n_plus_x_exception exc_6  (cost=0.43..593.79 rows=386 width=12) (actual time=0.022..0.306 rows=496 loops=10783)
                                                                  Index Cond: ((id_client = promotion.id_client) AND (id_sku = sku_17.id_sku) AND (start_date <= promotion.start_date) AND (end_date >= promotion.start_date))
                                                                  Heap Fetches: 978052
                                              ->  Index Scan using fct_sale_second_y2021_pkey on fct_sale_second_y2021 fss_110  (cost=1280.57..1288.64 rows=1 width=12) (never executed)
                                                    Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 17)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                              ->  Bitmap Heap Scan on fct_sale_second_y2022 fss_111  (cost=1715.32..3629.77 rows=130 width=12) (never executed)
                                                    Recheck Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 17)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                                    ->  Bitmap Index Scan on fct_sale_second_y2022_pkey  (cost=0.00..434.86 rows=521 width=0) (never executed)
                                                          Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                              ->  Bitmap Heap Scan on fct_sale_second_y2023 fss_112  (cost=2193.11..3656.67 rows=95 width=12) (actual time=26.845..33.279 rows=2028 loops=162)
                                                    Recheck Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 17)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                                    Rows Removed by Filter: 8764
                                                    Heap Blocks: exact=73208
                                                    ->  Bitmap Index Scan on fct_sale_second_y2023_pkey  (cost=0.00..912.66 rows=379 width=0) (actual time=24.273..24.273 rows=10792 loops=162)
                                                          Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                              ->  Index Scan using fct_sale_second_y2024_pkey on fct_sale_second_y2024 fss_113  (cost=1280.85..3407.30 rows=82 width=12) (actual time=2.961..44.727 rows=2515 loops=1393)
                                                    Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 17)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                                    Rows Removed by Filter: 16125
                                              ->  Index Scan using fct_sale_second_y2025_pkey on fct_sale_second_y2025 fss_114  (cost=1280.85..2303.79 rows=48 width=12) (actual time=2.612..38.954 rows=2401 loops=1063)
                                                    Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 17)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                                    Rows Removed by Filter: 19390
                                              ->  Index Scan using fct_sale_second_y2026_pkey on fct_sale_second_y2026 fss_115  (cost=1280.57..1288.64 rows=1 width=12) (never executed)
                                                    Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 17)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                              ->  Index Scan using fct_sale_second_y2027_pkey on fct_sale_second_y2027 fss_116  (cost=1280.57..1288.64 rows=1 width=12) (never executed)
                                                    Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 17)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                        ->  Materialize  (cost=0.00..84.75 rows=2 width=4) (actual time=0.000..0.000 rows=4 loops=6384397)
                                              ->  Seq Scan on dim_sku sku_19  (cost=0.00..84.74 rows=2 width=4) (actual time=0.044..0.116 rows=4 loops=2366)
                                                    Filter: (id_common_sku = promo_sku.id_common_sku)
                                                    Rows Removed by Filter: 1268
  SubPlan 20
    ->  Aggregate  (cost=24723.64..24723.65 rows=1 width=32) (actual time=128.121..128.121 rows=1 loops=2456)
          ->  Hash Join  (cost=18249.57..24723.63 rows=1 width=4) (actual time=101.222..128.101 rows=11 loops=2456)
                Hash Cond: (fss_117.tin_buyer = fss_126.tin_buyer)
                ->  Nested Loop  (cost=0.15..6474.20 rows=2 width=12) (actual time=43.805..89.910 rows=138 loops=2225)
                      ->  Seq Scan on dim_sku sku_21  (cost=0.00..84.74 rows=2 width=4) (actual time=0.064..0.213 rows=4 loops=2225)
                            Filter: (promo_sku.id_common_sku = id_common_sku)
                            Rows Removed by Filter: 1265
                      ->  Append  (cost=0.15..3194.64 rows=9 width=16) (actual time=16.336..20.716 rows=32 loops=9628)
                            ->  Index Scan using fct_sale_second_y2020_pkey on fct_sale_second_y2020 fss_118  (cost=0.15..6.18 rows=1 width=32) (never executed)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_21.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2021_pkey on fct_sale_second_y2021 fss_119  (cost=0.15..6.18 rows=1 width=32) (never executed)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_21.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2022_pkey on fct_sale_second_y2022 fss_120  (cost=0.43..462.08 rows=2 width=16) (never executed)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_21.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2023_pkey on fct_sale_second_y2023 fss_121  (cost=0.44..954.71 rows=1 width=16) (actual time=16.544..20.871 rows=16 loops=1068)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_21.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2024_pkey on fct_sale_second_y2024 fss_122  (cost=0.44..1231.87 rows=1 width=17) (actual time=14.290..17.834 rows=30 loops=6130)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_21.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2025_pkey on fct_sale_second_y2025 fss_123  (cost=0.43..521.23 rows=1 width=17) (actual time=14.189..18.059 rows=29 loops=3751)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_21.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2026_pkey on fct_sale_second_y2026 fss_124  (cost=0.15..6.18 rows=1 width=32) (never executed)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_21.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                            ->  Index Scan using fct_sale_second_y2027_pkey on fct_sale_second_y2027 fss_125  (cost=0.15..6.18 rows=1 width=32) (never executed)
                                  Index Cond: ((operation_date >= (promotion.start_date - (promotion.end_date - promotion.start_date))) AND (operation_date <= (promotion.start_date - 1)) AND (id_sku = sku_21.id_sku) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                ->  Hash  (cost=18249.41..18249.41 rows=1 width=8) (actual time=46.752..46.752 rows=27 loops=2448)
                      Buckets: 1024  Batches: 1  Memory Usage: 43kB
                      ->  Unique  (cost=18249.39..18249.40 rows=1 width=8) (actual time=46.733..46.741 rows=27 loops=2448)
                            ->  Sort  (cost=18249.39..18249.40 rows=1 width=8) (actual time=46.729..46.732 rows=34 loops=2448)
                                  Sort Key: fss_126.tin_buyer
                                  Sort Method: quicksort  Memory: 25kB
                                  ->  Nested Loop  (cost=1280.57..18249.38 rows=1 width=8) (actual time=11.836..46.702 rows=34 loops=2448)
                                        Join Filter: (fss_126.id_sku = sku_22.id_sku)
                                        Rows Removed by Join Filter: 9936
                                        ->  Append  (cost=1280.57..18153.87 rows=359 width=12) (actual time=4.213..44.767 rows=2608 loops=2448)
                                              ->  Index Scan using fct_sale_second_y2020_pkey on fct_sale_second_y2020 fss_127  (cost=1280.57..1288.64 rows=1 width=12) (never executed)
                                                    Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 19)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                                    SubPlan 19
                                                      ->  Nested Loop  (cost=0.43..1280.04 rows=152 width=8) (actual time=0.234..1.708 rows=2108 loops=2537)
                                                            ->  Seq Scan on dim_sku sku_20  (cost=0.00..84.74 rows=2 width=4) (actual time=0.084..0.188 rows=4 loops=2537)
                                                                  Filter: (id_common_sku = promo_sku.id_common_sku)
                                                                  Rows Removed by Filter: 1268
                                                            ->  Index Only Scan using idx_promo_n_plus_x_exception_composite on promo_n_plus_x_exception exc_7  (cost=0.43..593.79 rows=386 width=12) (actual time=0.022..0.304 rows=496 loops=10783)
                                                                  Index Cond: ((id_client = promotion.id_client) AND (id_sku = sku_20.id_sku) AND (start_date <= promotion.start_date) AND (end_date >= promotion.start_date))
                                                                  Heap Fetches: 978052
                                              ->  Index Scan using fct_sale_second_y2021_pkey on fct_sale_second_y2021 fss_128  (cost=1280.57..1288.64 rows=1 width=12) (never executed)
                                                    Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 19)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                              ->  Bitmap Heap Scan on fct_sale_second_y2022 fss_129  (cost=1715.32..3629.77 rows=130 width=12) (never executed)
                                                    Recheck Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 19)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                                    ->  Bitmap Index Scan on fct_sale_second_y2022_pkey  (cost=0.00..434.86 rows=521 width=0) (never executed)
                                                          Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                              ->  Bitmap Heap Scan on fct_sale_second_y2023 fss_130  (cost=2193.11..3656.67 rows=95 width=12) (actual time=27.222..34.561 rows=2028 loops=162)
                                                    Recheck Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 19)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                                    Rows Removed by Filter: 8764
                                                    Heap Blocks: exact=73208
                                                    ->  Bitmap Index Scan on fct_sale_second_y2023_pkey  (cost=0.00..912.66 rows=379 width=0) (actual time=24.659..24.659 rows=10792 loops=162)
                                                          Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                              ->  Index Scan using fct_sale_second_y2024_pkey on fct_sale_second_y2024 fss_131  (cost=1280.85..3407.30 rows=82 width=12) (actual time=2.936..44.510 rows=2515 loops=1393)
                                                    Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 19)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                                    Rows Removed by Filter: 16125
                                              ->  Index Scan using fct_sale_second_y2025_pkey on fct_sale_second_y2025 fss_132  (cost=1280.85..2303.79 rows=48 width=12) (actual time=2.581..38.718 rows=2401 loops=1063)
                                                    Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 19)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                                    Rows Removed by Filter: 19390
                                              ->  Index Scan using fct_sale_second_y2026_pkey on fct_sale_second_y2026 fss_133  (cost=1280.57..1288.64 rows=1 width=12) (never executed)
                                                    Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 19)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                              ->  Index Scan using fct_sale_second_y2027_pkey on fct_sale_second_y2027 fss_134  (cost=1280.57..1288.64 rows=1 width=12) (never executed)
                                                    Index Cond: ((operation_date >= promotion.start_date) AND (operation_date <= promotion.end_date) AND (id_client = promotion.id_client) AND (id_operation_type = 4) AND (delete_date = '2000-01-01 00:00:00'::timestamp without time zone))
                                                    Filter: ((NOT (hashed SubPlan 19)) AND CASE WHEN (id_client = ANY ('{36,37}'::integer[])) THEN CASE WHEN (promotion.id_promotion_type = 0) THEN ((quantity % '2'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 1) THEN ((quantity % '3'::numeric) = '0'::numeric) WHEN (promotion.id_promotion_type = 2) THEN ((quantity % '4'::numeric) = '0'::numeric) ELSE NULL::boolean END ELSE CASE WHEN (promotion.id_promotion_type = 0) THEN (quantity >= '2'::numeric) WHEN (promotion.id_promotion_type = 1) THEN (quantity >= '3'::numeric) WHEN (promotion.id_promotion_type = 2) THEN (quantity >= '4'::numeric) ELSE NULL::boolean END END)
                                        ->  Materialize  (cost=0.00..84.75 rows=2 width=4) (actual time=0.000..0.000 rows=4 loops=6384397)
                                              ->  Seq Scan on dim_sku sku_22  (cost=0.00..84.74 rows=2 width=4) (actual time=0.043..0.115 rows=4 loops=2366)
                                                    Filter: (id_common_sku = promo_sku.id_common_sku)
                                                    Rows Removed by Filter: 1268
Planning Time: 69.549 ms
JIT:
  Functions: 1909
  Options: Inlining true, Optimization true, Expressions true, Deforming true
  Timing: Generation 392.608 ms, Inlining 364.366 ms, Optimization 12408.415 ms, Emission 7968.914 ms, Total 21134.302 ms
Execution Time: 2589315.369 ms